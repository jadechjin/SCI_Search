# 论文检索模块设计方案（1）——使用自然语言实现文献精准定位

---

## 模块定位与功能边界

### 定位

论文检索模块是整个写作系统的**入口模块**，职责是将用户的研究意图转化为结构化的文献集合，供下游模块消费。它不负责深度阅读或综述生成，只负责"找到对的论文并组织好"。

### 核心能力分层

```
┌─────────────────────────────────────────────────┐
│                论文检索模块 (paper-search)         │
├─────────────────────────────────────────────────┤
│  L1 意图理解层                                    │
│    ├─ 自然语言 → 研究主题提取                      │
│    ├─ 关键概念识别（方法、领域、对象）               │
│    └─ 检索意图分类（综述型/方法型/数据集型/基线型）   │
├─────────────────────────────────────────────────┤
│  L2 查询构建层                                    │
│    ├─ 关键词生成与同义词扩展                       │
│    ├─ 布尔查询组合                                │
│    └─ 多数据库查询适配（不同API的语法差异）          │
├─────────────────────────────────────────────────┤
│  L3 检索执行层                                    │
│    ├─ 多源并行检索                                │
│    ├─ 分页与限流控制                              │
│    └─ 错误重试与降级                              │
├─────────────────────────────────────────────────┤
│  L4 结果处理层                                    │
│    ├─ 跨源去重（基于DOI/标题相似度）                │
│    ├─ AI相关性评分                                │
│    ├─ 多维排序（相关性/引用量/时间/影响因子）        │
│    └─ 结果筛选与分组                              │
└─────────────────────────────────────────────────┘
```

### 与下游模块的接口定义

检索模块的输出应是一个标准化的 `PaperCollection` 对象，下游模块统一消费这个格式：

```typescript
// 检索模块的标准输出格式
interface PaperCollection {
  metadata: {
    query: string;              // 原始用户输入
    searchStrategy: SearchStrategy; // 使用的检索策略（可复现）
    totalFound: number;
    timestamp: string;
  };
  papers: Paper[];
  facets: {                     // 聚合信息，供下游快速了解文献分布
    byYear: Record<number, number>;
    byVenue: Record<string, number>;
    topAuthors: string[];
    keyThemes: string[];        // AI提取的主题聚类
  };
}

interface Paper {
  id: string;                   // 内部唯一ID
  doi?: string;
  title: string;
  authors: Author[];
  abstract: string;
  year: number;
  venue: string;                // 期刊/会议名
  source: string;               // 来源数据库
  citationCount: number;
  relevanceScore: number;       // AI评分 0-1
  relevanceReason: string;      // AI给出的相关性说明（一句话）
  tags: string[];               // AI标注的标签（方法类/理论类/实证类等）
  fullTextUrl?: string;
  bibtex?: string;
}

// 下游模块消费示例：
// 文献综述模块：读取 papers + facets.keyThemes → 生成综述框架
// 引用管理模块：读取 papers.bibtex → 导入引用库
// 方法论模块：筛选 tags 包含"方法类"的 papers → 提取方法对比
```

---

## 工作流设计

### 执行流程

```
用户输入（自然语言描述研究主题）
        │
        ▼
┌──────────────────┐
│ Step 1: 意图解析  │  AI 驱动
│                  │  输出: ParsedIntent
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ Step 2: 策略生成  │  AI 驱动
│                  │  输出: SearchStrategy
└────────┬─────────┘
         │
         ▼
  ◆ 检查点1: 用户确认/调整检索策略 ◆  ← 人工介入
         │
         ▼
┌──────────────────┐
│ Step 3: 多源检索  │  API 调用
│                  │  输出: RawResults[]
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ Step 4: 去重聚合  │  算法驱动
│                  │  输出: DeduplicatedResults
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ Step 5: AI评估    │  AI 驱动（批量）
│  相关性评分+标注   │  输出: ScoredResults
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│ Step 6: 排序筛选  │  规则+AI
│  分组+摘要        │  输出: PaperCollection
└────────┬─────────┘
         │
         ▼
  ◆ 检查点2: 用户审阅结果 ◆  ← 人工介入
         │
    ┌────┴────┐
    │ 满意?   │
    ├─ 是 ──→ 输出最终 PaperCollection → 传递给下游
    └─ 否 ──→ 用户反馈 → 回到 Step 2（迭代检索）
```

### 各步骤的输入输出

| 步骤     | 输入                          | 输出                                                       | 驱动方   |
| -------- | ----------------------------- | ---------------------------------------------------------- | -------- |
| 意图解析 | 用户自然语言                  | `ParsedIntent{topic, concepts[], intentType, constraints}` | LLM      |
| 策略生成 | ParsedIntent                  | `SearchStrategy{queries[], sources[], filters}`            | LLM      |
| 多源检索 | SearchStrategy                | `RawResult[]`（每个源的原始返回）                          | API      |
| 去重聚合 | RawResult[]                   | `UnifiedPaper[]`（去重后的统一格式）                       | 算法     |
| AI评估   | UnifiedPaper[] + ParsedIntent | `ScoredPaper[]`（带评分和标注）                            | LLM      |
| 排序筛选 | ScoredPaper[] + 用户偏好      | `PaperCollection`（最终输出）                              | 规则+LLM |

### 人工介入检查点

**检查点1（策略确认）**— 推荐设为可选：

- 展示 AI 生成的关键词、查询表达式、选择的数据库
- 用户可以增删关键词、调整数据库范围、设置时间/语言过滤
- 对于熟练用户可跳过此步

**检查点2（结果审阅）**— 推荐设为必选：

- 展示检索统计（总数、各源分布、年份分布）
- 展示 Top-N 论文列表（标题+相关性说明+评分）
- 用户可以：标记"必须包含"/"排除"的论文、要求扩展某个子方向、调整相关性阈值

---

## 技术实现方案

### 推荐数据库与 API

按优先级排序，根据学科领域组合使用：

| API                      | 优势                                     | 限制                | 适用场景        |
| ------------------------ | ---------------------------------------- | ------------------- | --------------- |
| **Semantic Scholar**     | 免费、结构化好、有引用图谱、支持语义搜索 | 覆盖面偏CS/生物医学 | **首选通用源**  |
| **OpenAlex**             | 完全免费、覆盖面最广(2.5亿+)、有概念标签 | 数据质量参差        | **首选补充源**  |
| **arXiv**                | 免费、预印本即时获取、全文可下载         | 仅预印本、学科有限  | CS/物理/数学    |
| **PubMed (E-utilities)** | 权威、MeSH词表、结构化查询               | 仅生物医学          | 医学/生物       |
| **CrossRef**             | DOI权威源、元数据丰富                    | 无语义搜索          | 元数据补全/去重 |
| **CORE**                 | 开放获取全文                             | 检索能力弱          | 获取全文PDF     |
| **Serp api**             | 开放获取谷歌学术的资源                   |                     | **首选补充源**  |



### 检索策略设计

```
用户输入: "我想研究大语言模型在医学影像诊断中的应用"

Step 1 - AI 意图解析:
{
  topic: "大语言模型在医学影像诊断中的应用",
  concepts: ["大语言模型/LLM", "医学影像/Medical Imaging", "诊断/Diagnosis"],
  intentType: "survey",        // 综述型检索
  constraints: { years: null, language: null }
}

Step 2 - AI 查询扩展与构建:
{
  queries: [
    // 主查询
    {
      keywords: ["large language model", "medical imaging", "diagnosis"],
      synonyms: {
        "large language model": ["LLM", "GPT", "foundation model", "generative AI"],
        "medical imaging": ["radiology", "medical image analysis", "diagnostic imaging"],
        "diagnosis": ["clinical diagnosis", "disease detection", "diagnostic accuracy"]
      },
      booleanQuery: "(large language model OR LLM OR GPT OR foundation model) AND (medical imaging OR radiology OR diagnostic imaging) AND (diagnosis OR detection OR classification)"
    },
    // 补充查询（捕获相关但表述不同的论文）
    {
      booleanQuery: "(multimodal AI OR vision-language model) AND (radiology report OR pathology)"
    }
  ],
  sources: ["semantic_scholar", "pubmed", "arxiv"],
  filters: { yearFrom: 2020, limit: 200 }
}
```

### AI 在各环节的具体角色

**意图理解（Prompt 设计要点）**：

```
系统提示核心指令（材料科学 / 工程材料方向）：

1) 从用户描述中提取研究要素（材料学六要素）
- 材料对象（Material System）：成分/化学式/合金牌号/掺杂元素/相(phase)/晶体结构/形貌
- 工艺与制备（Processing）：合成路线、热处理、烧结、沉积、3D打印、表面处理、气氛/温度/压力/时间等
- 组织与结构（Structure）：晶粒尺寸、织构、缺陷、界面、孔隙率、纳米结构、层状/多孔等
- 性能与指标（Properties）：力学/电学/热学/磁学/光学/电化学/耐腐蚀/耐高温等 + 具体指标（强度、导电率、Seebeck、k、循环寿命…）
- 机理与模型（Mechanism/Model）：相变、扩散、析出、断裂、传导机制、反应路径、热力学/动力学模型、DFT/MD/相场等
- 应用场景与约束（Application/Constraints）：服役环境、成本、可规模化、毒性/法规、兼容性等

2) 关键概念分型（用于检索拆词与扩词）
- 领域/任务：如“固态电池界面”“高熵合金力学”“钙钛矿稳定性”“热电材料优化”
- 方法/手段：实验（制备+表征+测试）/计算（DFT、MD、CALPHAD、相场）/数据驱动（ML、HT）
- 对象/体系：具体材料家族（氧化物、硫化物、聚合物、复合材料、涂层、催化剂等）
- 评价体系：测试标准(ASTM/ISO)、测量条件、样品制备规范、数据处理方式

3) 判断检索意图类型（材料学语境重写）
- survey（领域全景）：想快速摸清“这个材料方向大家做什么、主线是什么、争议点在哪”
  → 宽泛检索：review / perspective / roadmap / handbook / book chapter / recent progress

- method（找实现路径/具体做法）：想知道“怎么做、怎么测、怎么建模、参数怎么选”
  → 精准检索：protocol / synthesis route / processing window / characterization workflow / computational setup

- baseline（材料学对照基准/参照体系）：想确定“用什么做对照、用什么标准/经典体系作为参照”
  典型 baseline 在材料里常见三类：
  a) 对照材料/参照配方：商用材料、经典材料体系、标准合金/电极/催化剂（如 316L、P25 TiO2、NMC111/622/811 等）
  b) 基准性能与测试条件：行业/文献公认的指标范围 + 标准测试方法（ASTM/ISO/IEC）
  c) 基准模型/理论：经典机理模型、经验公式、常用本构/传输模型（Hall–Petch、JMAK、Percolation、Butler–Volmer 等）
  → 检索目标：benchmark/comparative studies、round-robin、standard test method papers、经典综述/手册条目

- dataset（材料数据源/数据库/可复用数据）：想找“可直接用的数据（实验/计算/图谱/相图/结构）”
  常见 dataset 在材料里包括：
  a) 计算材料数据库：Materials Project、AFLOW、OQMD、NOMAD 等（结构、能量、带隙、弹性等）
  b) 结构/物相数据库：ICSD、COD、PDF（衍射卡片）、相图/热力学库（CALPHAD相关）
  c) 实验测试/图谱数据：XRD/SEM/TEM/EDS/XPS/Raman/电化学曲线/力学曲线等开放数据仓库
  d) 工程材料属性库：MatWeb、NIST/ASM 数据等
  → 检索目标：dataset paper / database paper / data descriptor / repository + “open data” + “supplementary dataset”

4) 识别隐含约束并映射到“应该查哪里”（材料领域必备）
- 若包含“结构/晶体/相” → 优先：ICSD/COD/Materials Project/AFLOW + 结构关键词（space group, polymorph）
- 若包含“相图/热处理/合金设计” → 优先：CALPHAD、phase diagram、ASM handbooks、合金牌号标准
- 若包含“聚合物/有机合成路线” → 优先：SciFinder / Reaxys / 聚合机理与配方相关资源
- 若包含“测试可比性/标准化” → 优先：ASTM/ISO/IEC 标准、round-robin、inter-lab study
- 若包含“工程应用/商用对标” → 优先：技术手册、标准牌号数据、产业白皮书、专利（工艺窗口、配方）

5) 输出检索计划（给后续检索/问答用）
- 给出：意图类型 + 关键拆词（材料/工艺/结构/性能/条件）+ 同义词/别名（牌号、缩写、化学式）
- 给出：优先资源清单（数据库/标准/期刊/专利）+ 2~4 组检索式（宽到窄）
- 明确：需要固定的对比条件（温度、气氛、电流密度、扫描速率、样品制备等）避免“不可比数据”
- 明确：检索到的文献必须要附带 DOI 号供用户检索
```

**相关性评估（批量处理，控制成本）**：

```
对每篇论文，基于标题+摘要，AI 输出：
- relevanceScore: 0-1 (与研究主题的相关程度)
- relevanceReason: 一句话说明为什么相关/不相关
- tags: [方法类, 综述类, 实证类, 理论类, 数据集类]

关键实现细节：
- 批量处理：每次将 10-20 篇论文的标题+摘要打包给 AI
- 提供评分锚点：在 prompt 中给出 1.0/0.7/0.3/0.0 的示例
```

**迭代优化**：

```
当用户对结果不满意时，AI 分析用户反馈：
- 用户标记了哪些论文为"相关"/"不相关"
- 从这些标注中学习用户真实意图
- 调整查询策略：增加/减少关键词、调整布尔逻辑、切换数据库
```

---

## 架构建议

### 推荐架构：多步骤 Workflow + 细粒度子 Skill

论文检索不适合做成单一 Skill，原因是：

- 流程中有人工检查点，需要暂停和恢复
- 各步骤的技术栈不同（LLM / API调用 / 算法）
- 需要支持迭代，单一 Skill 难以处理循环

推荐拆分方式：

```
paper-search (Workflow 编排器)
│
├── skill: intent-parser
│   └── AI解析用户意图 → ParsedIntent
│
├── skill: query-builder  
│   └── AI生成检索策略 → SearchStrategy
│
├── skill: multi-source-searcher
│   ├── adapter: semantic-scholar
│   ├── adapter: openalex
│   ├── adapter: arxiv
│   ├── adapter: pubmed
│   └── 并行调用 + 结果聚合 → RawResults[]
│
├── skill: deduplicator
│   └── DOI匹配 + 标题模糊匹配 → UnifiedPapers[]
│
├── skill: relevance-scorer
│   └── AI批量评分+标注 → ScoredPapers[]
│
└── skill: result-organizer
    └── 排序+筛选+分组+摘要 → PaperCollection
```

### 迭代式检索的支持

```
                    ┌──────────────────────┐
                    │  Workflow 状态管理器   │
                    │                      │
                    │  state: {            │
                    │    iteration: number  │
                    │    history: [         │  ← 保留每轮的策略和结果
                    │      { strategy,     │
                    │        results,      │
                    │        feedback }    │
                    │    ],                │
                    │    accumulated:      │  ← 跨轮次累积的"确认相关"论文
                    │      Paper[]         │
                    │  }                   │
                    └──────────┬───────────┘
                               │
          ┌────────────────────┼────────────────────┐
          │                    │                    │
     第1轮迭代            第2轮迭代             第N轮迭代
   (宽泛检索)         (根据反馈聚焦)        (补充特定方向)
```

每轮迭代中，`query-builder` 接收的输入增加了历史上下文：

```typescript
interface QueryBuilderInput {
  intent: ParsedIntent;
  // 迭代时额外提供：
  previousStrategies?: SearchStrategy[];   // 之前用过的策略（避免重复）
  userFeedback?: {
    markedRelevant: Paper[];               // 用户标记为相关的
    markedIrrelevant: Paper[];             // 用户标记为不相关的
    freeTextFeedback?: string;             // 用户的文字反馈
  };
}
```

---



